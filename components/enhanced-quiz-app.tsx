"use client"

import { useState } from "react"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardFooter, CardHeader, CardTitle } from "@/components/ui/card"
import { Checkbox } from "@/components/ui/checkbox"
import { Label } from "@/components/ui/label"
import { Input } from "@/components/ui/input"
import { AlertCircle, CheckCircle, BookOpen, GraduationCap } from "lucide-react"

const questionBanks = {
    NWC204_FA24_FE_Trial_191302: [
        {
            question:
                "What two ICMPv6 message types must be permitted through IPv6 access control lists to allow resolution of Layer 3 addresses to Layer 2 MAC addresses? (Choose two.)",
            options: [
                "neighbor solicitations",
                "echo requests",
                "neighbor advertisements",
                "echo replies",
                "router solicitations",
                "router advertisements",
            ],
            correctAnswers: [
                "neighbor solicitations",
                "neighbor advertisements",
            ],
        },
        {
            question:
                "Which range of link-local addresses can be assigned to an IPv6-enabled interface?",
            options: ["FEC0::/10", "FDEE::/7", "FE80::/10", "FF00::/8"],
            correctAnswers: ["FE80::/10"],
        },
        {
            question:
                "What would be the interface ID of an IPv6-enabled interface with a MAC address of 1C-6F-65-C2-BD-F8 when the interface ID is generated by using the EUI-64 process?",
            options: [
                "0C6F:65FF:FEC2:BDF8",
                "1E6F:65FF:FEC2:BDF8",
                "C16F:65FF:FEC2:BDF8",
                "106F:65FF:FEC2:BDF8",
            ],
            correctAnswers: ["1E6F:65FF:FEC2:BDF8"],
        },
        {
            question:
                "An organization is assigned an IPv6 address block of 2001:db8:0:ca00::/56. How many subnets can be created without using bits in the interface ID space?",
            options: ["256", "512", "1024", "4096"],
            correctAnswers: ["256"],
        },
        {
            question:
                "When a switch configuration includes a user-defined error threshold on a per-port basis, to which switching method will the switch revert when the error threshold is reached?",
            options: [
                "cut-through",
                "store-and-forward",
                "fast-forward",
                "fragment-free",
            ],
            correctAnswers: ["store-and-forward"],
        },
        {
            question:
                "Which two statements are correct about MAC and IP addresses during data transmission if NAT is not involved? (Choose two.)",
            options: [
                "Destination IP addresses in a packet header remain constant along the entire path to a target host.",
                "Destination MAC addresses will never change in a frame that goes across seven routers.",
                "Every time a frame is encapsulated with a new destination MAC address, a new destination IP address is needed.",
                "Destination and source MAC addresses have local significance and change every time a frame goes from one LAN to another.",
                "A packet that has crossed four routers has changed the destination IP address four times.",
            ],
            correctAnswers: [
                "Destination IP addresses in a packet header remain constant along the entire path to a target host.",
                "Destination and source MAC addresses have local significance and change every time a frame goes from one LAN to another.",
            ],
        },
        {
            question: "What is one main characteristic of the data link layer?",
            options: [
                "It generates the electrical or optical signals that represent the 1 and 0 on the media.",
                "It converts a stream of data bits into a predefined code.",
                "It shields the upper layer protocol from being aware of the physical medium to be used in the communication.",
                "It accepts Layer 3 packets and decides the path by which to forward the packet to a remote network.",
            ],
            correctAnswers: [
                "It shields the upper layer protocol from being aware of the physical medium to be used in the communication.",
            ],
        },
        {
            question:
                "What are three characteristics of the CSMA/CD process? (Choose three.)",
            options: [
                "The device with the electronic token is the only one that can transmit after a collision.",
                "A device listens and waits until the media is not busy before transmitting.",
                "After detecting a collision, hosts can attempt to resume transmission after a random time delay has expired.",
                "All of the devices on a segment see data that passes on the network medium.",
                "A jam signal indicates that the collision has cleared and the media is not busy.",
                "Devices can be configured with a higher transmission priority.",
            ],
            correctAnswers: [
                "A device listens and waits until the media is not busy before transmitting.",
                "After detecting a collision, hosts can attempt to resume transmission after a random time delay has expired.",
                "All of the devices on a segment see data that passes on the network medium.",
            ],
        },
        {
            question:
                "What are two primary responsibilities of the Ethernet MAC sublayer? (Choose two.)",
            options: [
                "error detection",
                "frame delimiting",
                "accessing the media",
                "data encapsulation",
                "logical addressing",
            ],
            correctAnswers: ["frame delimiting", "accessing the media"],
        },
        {
            question:
                "Which two commands can be used on a Windows host to display the routing table? (Choose two.)",
            options: [
                "netstat -s",
                "route print",
                "show ip route",
                "netstat -r",
                "tracert",
            ],
            correctAnswers: ["route print", "netstat -r"],
        },
        {
            question:
                "What are two functions that are provided by the network layer? (Choose two.)",
            options: [
                "directing data packets to destination hosts on other networks",
                "placing data on the network medium",
                "carrying data between processes that are running on source and destination hosts",
                "providing dedicated end-to-end connections",
                "providing end devices with a unique network identifier",
            ],
            correctAnswers: [
                "directing data packets to destination hosts on other networks",
                "providing end devices with a unique network identifier",
            ],
        },
        {
            question:
                "Which two statements describe features of an IPv4 routing table on a router? (Choose two.)",
            options: [
                "Directly connected interfaces will have two route source codes in the routing table: C and S.",
                "If there are two or more possible routes to the same destination, the route associated with the higher metric value is included in the routing table.",
                "The netstat -r command can be used to display the routing table of a router.",
                "The routing table lists the MAC addresses of each active interface.",
                "If a default static route is configured in the router, an entry will be included in the routing table with source code S.",
                "It stores information about routes derived from the active router interfaces.",
            ],
            correctAnswers: [
                "If a default static route is configured in the router, an entry will be included in the routing table with source code S.",
                "It stores information about routes derived from the active router interfaces.",
            ],
        },
        {
            question:
                "How does the service password-encryption command enhance password security on Cisco routers and switches?",
            options: [
                "It requires encrypted passwords to be used when connecting remotely to a router or switch with Telnet.",
                "It encrypts passwords that are stored in router or switch configuration files.",
                "It requires that a user type encrypted passwords to gain console access to a router or switch.",
                "It encrypts passwords as they are sent across the network.",
            ],
            correctAnswers: [
                "It encrypts passwords that are stored in router or switch configuration files.",
            ],
        },
        {
            question: "Why would a Layer 2 switch need an IP address?",
            options: [
                "to enable the switch to send broadcast frames to attached PCs",
                "to enable the switch to function as a default gateway",
                "to enable the switch to be managed remotely",
                "to enable the switch to receive frames from attached PCs",
            ],
            correctAnswers: ["to enable the switch to be managed remotely"],
        },
        {
            question: "What characteristic describes identity theft?",
            options: [
                "the use of stolen credentials to access private data",
                "software on a router that filters traffic based on IP addresses or applications",
                "software that identifies fast-spreading threats",
                "a tunneling protocol that provides remote users with secure access into the network of an organization",
            ],
            correctAnswers: [
                "the use of stolen credentials to access private data",
            ],
        },
    ],
    SCIENCE202: [
        {
            question: "Which of these are states of matter?",
            options: ["Solid", "Liquid", "Gas", "Energy"],
            correctAnswers: ["Solid", "Liquid", "Gas"],
        },
        {
            question: "Which of these are types of renewable energy?",
            options: ["Solar", "Wind", "Coal", "Nuclear"],
            correctAnswers: ["Solar", "Wind"],
        },
        {
            question: "Which of these are parts of a plant cell?",
            options: ["Cell wall", "Chloroplast", "Mitochondria", "Nucleus"],
            correctAnswers: [
                "Cell wall",
                "Chloroplast",
                "Mitochondria",
                "Nucleus",
            ],
        },
    ],
}

export function EnhancedQuizAppComponent() {
  const [currentQuestion, setCurrentQuestion] = useState(0)
  const [selectedAnswers, setSelectedAnswers] = useState<string[]>([])
  const [score, setScore] = useState(0)
  const [quizCompleted, setQuizCompleted] = useState(false)
  const [questions, setQuestions] = useState([])
  const [codeInput, setCodeInput] = useState("")
  const [answeredQuestions, setAnsweredQuestions] = useState([])
  const [showFeedback, setShowFeedback] = useState(false)
  const [currentQuizTheme, setCurrentQuizTheme] = useState("")

  const loadQuestions = (code) => {
    const upperCode = code
    if (questionBanks[upperCode]) {
      setQuestions(questionBanks[upperCode])
      setCurrentQuestion(0)
      setScore(0)
      setQuizCompleted(false)
      setAnsweredQuestions([])
      setSelectedAnswers([])
      setCurrentQuizTheme(upperCode.includes("HISTORY") ? "history" : "science")
    } else {
      alert("Invalid code. Please try again.")
    }
  }

  const handleAnswerSelection = (answer: string) => {
    setSelectedAnswers(prev => 
      prev.includes(answer) 
        ? prev.filter(a => a !== answer) 
        : [...prev, answer]
    )
  }

  const handleNextQuestion = () => {
    const currentQuestionData = questions[currentQuestion]
    const isFullyCorrect = currentQuestionData.correctAnswers.every(a => selectedAnswers.includes(a)) &&
                           selectedAnswers.length === currentQuestionData.correctAnswers.length
    
    if (isFullyCorrect) {
      setScore(score + 1)
    }

    setAnsweredQuestions([...answeredQuestions, { 
      question: currentQuestionData.question, 
      selectedAnswers,
      correctAnswers: currentQuestionData.correctAnswers,
      isCorrect: isFullyCorrect 
    }])

    setShowFeedback(true)
  }

  const moveToNextQuestion = () => {
    if (currentQuestion + 1 < questions.length) {
      setCurrentQuestion(currentQuestion + 1)
      setSelectedAnswers([])
      setShowFeedback(false)
    } else {
      setQuizCompleted(true)
    }
  }

  const restartQuiz = () => {
    setCurrentQuestion(0)
    setSelectedAnswers([])
    setScore(0)
    setQuizCompleted(false)
    setQuestions([])
    setCodeInput("")
    setAnsweredQuestions([])
    setShowFeedback(false)
    setCurrentQuizTheme("")
  }

  const getThemeClass = () => {
    switch (currentQuizTheme) {
      case "history":
        return "bg-amber-100"
      case "science":
        return "bg-blue-100"
      default:
        return "bg-gray-100"
    }
  }

  return (
    <div className={`min-h-screen flex items-center justify-center ${getThemeClass()}`}>
      <Card className="w-full max-w-2xl shadow-lg">
        <CardHeader className={`${currentQuizTheme === "history" ? "bg-amber-200" : currentQuizTheme === "science" ? "bg-blue-200" : "bg-gray-200"} rounded-t-lg`}>
          <CardTitle className="text-3xl font-bold text-center flex items-center justify-center">
            {currentQuizTheme === "history" ? <BookOpen className="mr-2" /> : currentQuizTheme === "science" ? <GraduationCap className="mr-2" /> : null}
            Enhanced Quiz App
          </CardTitle>
        </CardHeader>
        <CardContent className="p-6">
          {questions.length === 0 ? (
            <div className="space-y-4">
              <Label htmlFor="code-input" className="text-lg font-semibold">Enter quiz code:</Label>
              <Input
                id="code-input"
                type="text"
                value={codeInput}
                onChange={(e) => setCodeInput(e.target.value)}
                placeholder="e.g., HISTORY101"
                className="text-lg"
              />
              <Button onClick={() => loadQuestions(codeInput)} className="w-full text-lg">
                Start Quiz
              </Button>
            </div>
          ) : !quizCompleted ? (
            <>
              <h2 className="text-2xl font-semibold mb-4">
                Question {currentQuestion + 1} of {questions.length}
              </h2>
              <p className="text-xl mb-6">{questions[currentQuestion].question}</p>
              <div className="space-y-4">
                {questions[currentQuestion].options.map((option, index) => (
                  <div key={index} className="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100">
                    <Checkbox
                      id={`option-${index}`}
                      checked={selectedAnswers.includes(option)}
                      onCheckedChange={() => handleAnswerSelection(option)}
                      disabled={showFeedback}
                    />
                    <Label htmlFor={`option-${index}`} className="text-lg cursor-pointer flex-grow">
                      {option}
                    </Label>
                    {showFeedback && (
                      questions[currentQuestion].correctAnswers.includes(option) ? (
                        <CheckCircle className="text-green-500" />
                      ) : selectedAnswers.includes(option) ? (
                        <AlertCircle className="text-red-500" />
                      ) : null
                    )}
                  </div>
                ))}
              </div>
              {showFeedback && (
                <div className="mt-6 p-4 bg-gray-100 rounded-lg">
                  <p className="text-lg font-semibold">
                    {answeredQuestions[currentQuestion].isCorrect ? (
                      <span className="text-green-600">Correct!</span>
                    ) : (
                      <span className="text-red-600">Incorrect.</span>
                    )}
                  </p>
                  <p className="mt-2">
                    Correct answer{questions[currentQuestion].correctAnswers.length > 1 ? "s" : ""}:{" "}
                    {questions[currentQuestion].correctAnswers.join(", ")}
                  </p>
                </div>
              )}
            </>
          ) : (
            <div className="space-y-6">
              <h2 className="text-3xl font-bold mb-4">Quiz Completed!</h2>
              <p className="text-2xl mb-6">
                Your score: {score} out of {questions.length}
              </p>
              <div className="space-y-4">
                {answeredQuestions.map((q, index) => (
                  <div key={index} className="p-4 bg-gray-100 rounded-lg">
                    <div className="flex items-center space-x-2 mb-2">
                      {q.isCorrect ? (
                        <CheckCircle className="text-green-500" />
                      ) : (
                        <AlertCircle className="text-red-500" />
                      )}
                      <p className="font-semibold">{q.question}</p>
                    </div>
                    <p>Your answer: {q.selectedAnswers.join(", ")}</p>
                    <p>Correct answer: {q.correctAnswers.join(", ")}</p>
                  </div>
                ))}
              </div>
            </div>
          )}
        </CardContent>
        <CardFooter className="flex justify-center p-6">
          {questions.length > 0 && !quizCompleted ? (
            showFeedback ? (
              <Button onClick={moveToNextQuestion} className="text-lg">
                {currentQuestion + 1 === questions.length ? "Finish Quiz" : "Next Question"}
              </Button>
            ) : (
              <Button onClick={handleNextQuestion} disabled={selectedAnswers.length === 0} className="text-lg">
                Check Answer
              </Button>
            )
          ) : (
            <Button onClick={restartQuiz} className="text-lg">Start New Quiz</Button>
          )}
        </CardFooter>
      </Card>
    </div>
  )
}